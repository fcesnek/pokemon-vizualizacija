<!DOCTYPE html>
<!-- http://bl.ocks.org/eesur/1a2514440351ec22f176 -->
<!-- http://syntagmatic.github.com/parallel-coordinates/ -->

<head>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
    integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

  <link rel="stylesheet" type="text/css" href="./css/style.css">
  <link rel="stylesheet" type="text/css" href="./css/pokemon.css">
  <link rel="stylesheet" type="text/css" href="./css/checkbox.css">
  <link rel="stylesheet" type="text/css" href="./css/fonts/fonts.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js"></script>
  <script src="./scripts/libs/d3.parcoords.js"></script>
  <script src="./scripts/libs/divgrid.js"></script>

</head>

<body>

  <nav class="nav-icons">
    <a href="index.html" class="menu-green"><i class="fas fa-grip-lines-vertical"></i><span>Parallel
        Coordinates</span></a>
    <a href="radar.html" class="menu-yellow"><i class="fas fa-dharmachakra"></i><span>Radar Chart</span></a>
    <a href="https://github.com/fcesnek/pokemon-vizualizacija" class="menu-blue"><i
        class="fas fa-code"></i><span>Code</span></a>
  </nav>

  <hr>

  <div id="parallel-coords" class="parcoords">
  </div>
  <div id="filter">
    <ul id="filterList">
    </ul>
  </div>
  <hr>
  <div class="container">
    <div id="grid">
      <div>
        <label>Search by name:</label>
        <input type="text" id="pokemonname" />
      </div>
    </div>
  </div>
  <div class="end"></div>

  <script>
    let defaultVals = ["#", "Type 1", "Type 2", "Legendary"]
    let hideAxisVals = ["#"]
    let filterKeys = ["Type 1", "Type 2", "Total", "HP", "Attack", "Defense", "Sp. Atk", "Sp. Def", "Speed",
      "Generation", "Legendary"
    ]
    var colorscheme = d3.scale.linear()
      .domain([0, 7])
      .range(["steelblue", "yellow"])
      .interpolate(d3.interpolateLab);
    var grid = d3.divgrid();
    var parcoords;

    d3.select("#filterList").attr("class", "ks-cboxtags")
    let unorderedList = d3.select("#filterList").selectAll("li").data(filterKeys).enter().append("li")

    unorderedList.each(function (d, i) {
      d3.select(this)
        .append("input")
        .attr("type", "checkbox")
        .attr("id", function (d) {
          return `Checkbox${i}`
        })
        .attr("value", function (d) {
          return d;
        })
        .property("checked", function (d) {
          return hideAxisVals.includes(d) || defaultVals.includes(d) ? false : true;
        })

      d3.select(this)
        .append("label")
        .attr("for", function (d) {
          return `Checkbox${i}`
        })
        .html(function (d) {
          return d
        })
    })
    let checkBoxes = d3.select("#filterList").selectAll("input")

    d3.json('./data/pokemon.json', function (error, data) {
      checkBoxes.on("change", function () {
        cbUpdate(data)
      })
      drawParCoords(data)
    });

    function cbUpdate(data) {
      checkBoxes.each(function (d, i) {
        if (!d3.select(this).property("checked")) {
          if (!hideAxisVals.includes(d))
            hideAxisVals.push(d)
        } else {
          for (let i = 0; i < hideAxisVals.length; i++) {
            if (hideAxisVals[i] == d) {
              hideAxisVals.splice(i, 1);
            }
          }
        }
      })
      drawParCoords(data)
    }

    function drawParCoords(data) {
      if (d3.select("#parallel-coords")) {
        d3.select("#parallel-coords").selectAll("*").remove()
      }
      parcoords = d3.parcoords()("#parallel-coords")
        .data(data)
        .hideAxis(hideAxisVals.length == 1 ? defaultVals : hideAxisVals)
        .composite("darken")
        .color(function (d) {
          return colorscheme(d.Generation);
        })
        .alpha(0.2)
        .render()
        .brushMode("1D-axes")
        .reorderable();

      drawGrid(data)

      parcoords.on("brush", function (d) {
        drawGrid(d)
      });
      d3.select("#pokemonname").on("input", function () {
        drawGrid(data, this.value)
      });
    }

    function drawGrid(data, text) {
      d3.select("#grid")
        .datum(text ? data.filter(function (pokemon) {
          return pokemon.Name.toLowerCase().includes(text.toLowerCase())
        }) : data.slice(0, 20))
        .call(grid)
        .selectAll(".row")
        .on({
          "mouseover": function (d) {
            parcoords.highlight([d]);
            d3.select(this).style("cursor", "pointer");
          },
          "mouseout": parcoords.unhighlight,
          "click": function (d) {
            window.location.href = "radar.html" + "?id=" + d["#"];
          }
        });
    }
  </script>
</body>